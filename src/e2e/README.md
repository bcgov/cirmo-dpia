# E2E Test Suite

## Overview

This directory contains the end-to-end (E2E) tests for our frontend application, implemented using the **Playwright** testing framework.

## Getting Started

### Prerequisites

- Node.js (version **16** or higher)
- Ensure `.env` file has been properly created using the `.env-template` file

### Installation

1. To install the dependencies for the E2E tests, run the following command from the `e2e` directory:

```bash
npm install
```

2. To Install browsers required by Playwright (if they haven't been installed already):

```bash
npx playwright install
```

## Writing Tests

Place new test files in the appropriate folder within the `tests` directory. Follow our naming convention: `[feature-name].spec.ts`.

### Test File Structure

Craft your test files for clarity and efficiency using these guidelines:

1. **_Imports_**: Bring in Playwright's `test` and `expect` from `@playwright/test`, alongside any utility functions or Page Objects for encapsulating common actions and configurations.

2. **_Test Suites_**: Define related tests within `test.describe` blocks for better organization and shared setup/teardown operations.

3. **_Individual Tests_**: Use `test` blocks within suites to craft descriptive and focused test cases.

4. **_Setup and Teardown_**: Employ `test.beforeEach` and `test.afterEach` for consistent test initialization and cleanup actions, including credentials.

5. **_Navigation and URLs_**: Stick with `page.goto('/')` for root URL navigation and `page.goto('/path')` for subpaths, leveraging the `BASE_URL` variable for environment-specific URLs.

6. **_Assertions_**: Ensure assertions are expressive and detailed with the `expect` library, covering the full range of expected element states and interactions.

### Best Practices

- **_Clear Test Descriptions_**: Articulate the intention and expected outcome in your test names.

- **_Error Handling_**: Implement tests to handle errors gracefully, with explicit messages aiding debuggability.

- **_Test Isolation_**: Maintain test independence to facilitate parallel execution and reduce test flakiness.

- **_Page Object Models_**: Encapsulate complex interactions in Page Object models to minimize repetition and improve test clarity.

- **_Async Await_**: Ensure all asynchronous operations complete by properly awaiting Playwright's promises.

For more detailed options and implementations, refer to the Playwright [Writing tests](https://playwright.dev/docs/writing-tests) and [Generating tests](https://playwright.dev/docs/codegen-intro) documentation.

## Running Tests

To run tests, use one of the following npm scripts:

### Local Environment

- Headless test:

```bash
npm run playwright-local
```

- Test with UI:

```bash
npm run playwright-local-ui
```

- Test in debug mode:

```bash
npm run playwright-local-debug
```

### Dev Environment

- Headless test:

```bash
npm run playwright-dev
```

- Test with UI:

```bash
npm run playwright-dev-ui
```

- Test in debug mode:

```bash
npm run playwright-dev-debug
```

### Test Environment

- Headless test:

```bash
npm run playwright-test
```

- Test with UI:

```bash
npm run playwright-test-ui
```

- Test in debug mode:

```bash
npm run playwright-test-debug
```

### Linting

- For linting test files, run:

```bash
npm run lint
```

For more detailed CLI usage and other options, refer to the Playwright [Running and debugging tests](https://playwright.dev/docs/running-tests) documentation.

## Structure

The following is the structure of the E2E tests in this directory:

```plaintext
e2e/
│
├── playwright-report/                    # Stores reports generated by Playwright after test executions.
├── test-results/                         # Contains the results of the test executions, such as logs and artifacts.
│
├── tests/                                # Root folder for all end-to-end tests.
│   ├── modules/                          # Reusable test modules for common components and actions.
│   │   ├── piaFill/                      # Modules for testing 'piaFill' component with different roles.
│   │   │   ├── basicPiaFill.ts           # Basic 'piaFill' component tests, applicable for all roles.
│   │   │   ├── cpoPiaFill.ts             # 'piaFill' tests for the 'CPO' role.
│   │   │   ├── drafterPiaFill.ts         # 'piaFill' tests for the 'Drafter' role.
│   │   │   └── mpoPiaFill.ts             # 'piaFill' tests for the 'MPO' role.
│   │   └── index.ts                      # Index file to bundle and export modules.
│   │
│   ├── utils/                            # Utility functions and helpers to support tests.
│   │   ├── auth/                         # Authentication helpers to log in users with different roles.
│   │   │   ├── cpoAuth.ts                # Login function for users with the 'CPO' role.
│   │   │   ├── drafterAuth.ts            # Login function for users with the 'Drafter' role.
│   │   │   └── mpoAuth.ts                # Login function for users with the 'MPO' role.
│   │   ├── env/                         # File related to environment variables.
│   │   │   └── env.ts                    # Retrieve usernames and passwords from environment variables.
│   │   ├── uuid/                         # Functions related to UUID operations within tests.
│   │   │   ├── uuid.ts                   # Function to generate UUIDs for test data.
│   │   │   └── uuidSearch.ts             # Function to perform search operations using UUIDs.
│   │   └── index.ts                      # Index file to export utility functions.
│   │
│   ├── authorized.spec.ts                # Tests to ensure authorized users can access appropriate features.
│   ├── autosave.spec.ts                  # Tests for verifying the autosave functionality across the application.
│   ├── comments.spec.ts                  # Tests for the commenting feature within the app.
│   ├── filter.spec.ts                    # Tests to validate filtering logic and UI components.
│   ├── fullPia.spec.ts                   # Complete test suite for end-to-end 'pia' process validation.
│   ├── landingPage.spec.ts               # Tests the functionality and elements of the landing page.
│   ├── sort.spec.ts                      # Tests for features related to sorting PIA table in the app.
│   ├── search.spec.ts                    # Tests the search functionality, including edge cases and search accuracy.
│   ├── tooltip.spec.ts                   # Tests the integration and functionality of the tooltip within the app.
│   └── unauthorized.spec.ts              # Tests to ensure unauthorized users cannot access restricted areas.
│
├── .env                                  # Stores environment variables for the test environments.
├── .env-template                         # Template file for setting up '.env' with the necessary variables.
├── .eslintrc.js                          # ESLint rules for maintaining consistent code quality and style.
├── .prettierrc                           # Prettier configuration for automated code formatting.
├── package.json                          # Lists dependencies, scripts, and metadata for the test suite.
├── playwright.config.ts                  # Configuration settings for Playwright, defining global test behavior.
└── tsconfig.json                         # TypeScript compiler options for the e2e tests.
```
